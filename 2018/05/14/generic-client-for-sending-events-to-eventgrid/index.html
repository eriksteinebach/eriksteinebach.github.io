<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Generic client for sending events to Event Grid | NET, DevOps, Architecture, Azure, Erik Steinebach</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="azure,.net,event grid,eventing,microservices,http,client" />
    
    <meta name="description" content="To support the use of Event Grid in our application architecture we decided to build a generic Event Grid client to send our events. This client enforces some practices like the use of base events and">
<meta name="keywords" content="azure,.net,event grid,eventing,microservices,http,client">
<meta property="og:type" content="article">
<meta property="og:title" content="Generic client for sending events to Event Grid">
<meta property="og:url" content="http://eriksteinebach.com/2018/05/14/generic-client-for-sending-events-to-eventgrid/index.html">
<meta property="og:site_name" content="NET, DevOps, Architecture, Azure, Erik Steinebach">
<meta property="og:description" content="To support the use of Event Grid in our application architecture we decided to build a generic Event Grid client to send our events. This client enforces some practices like the use of base events and">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://eriksteinebach.com/2018/05/14/generic-client-for-sending-events-to-eventgrid/serverless-web-app.png">
<meta property="og:updated_time" content="2018-06-11T01:31:13.773Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Generic client for sending events to Event Grid">
<meta name="twitter:description" content="To support the use of Event Grid in our application architecture we decided to build a generic Event Grid client to send our events. This client enforces some practices like the use of base events and">
<meta name="twitter:image" content="http://eriksteinebach.com/2018/05/14/generic-client-for-sending-events-to-eventgrid/serverless-web-app.png">
    

    

    

    <link rel="stylesheet" href="/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/vendor/titillium-web/styles.css">
    <link rel="stylesheet" href="/vendor/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/vendor/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/vendor/fancybox/jquery.fancybox.css">
    
    
        <link rel="stylesheet" href="/vendor/scrollLoading/style.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-30164253-2', 'auto');
ga('send', 'pageview');

</script>
    
    

    
    <link rel="canonical" href="http://eriksteinebach.com/2018/05/14/generic-client-for-sending-events-to-eventgrid/"/>
    
    <script type="application/ld+json">
  {
    "@context" : "http://schema.org",
    "@type" : "WebSite",
    "name" : "NET, DevOps, Architecture, Azure, Erik Steinebach",
    "url" : "http://eriksteinebach.com"
  }
</script>

<script type="application/ld+json">
  { "@context" : "http://schema.org",
    "@type" : "Organization",
    "name" : "Erik Steinebach",
    "url" : "http://eriksteinebach.com",
    "logo": "http://eriksteinebach.com/images/about.jpg",
    "sameAs" : [ "" ]
  }
</script>


    	
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#000000"
    },
    "button": {
      "background": "#006bde"
    }
  }
})});
</script>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-5116727246177164",
    enable_page_level_ads: true
  });
</script>


</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <!--div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">Erik Steinebach</p>
                        </h2>
                    
                </div-->
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Architecture/">Architecture</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Coding/">Coding</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/DevOps/">DevOps</a></li></ul>
                                    
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/about/">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Coding/">Coding</a>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-generic-client-for-sending-events-to-eventgrid" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        Generic client for sending events to Event Grid
        </h1>
    

            </header>
        
        <div class="article-subtitle">
            <a href="/2018/05/14/generic-client-for-sending-events-to-eventgrid/" class="article-date">
    <time datetime="2018-05-14T13:05:45.000Z" itemprop="datePublished">2018-05-14</time>
</a>
            
    <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/net/">.net</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/azure/">azure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/client/">client</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/event-grid/">event grid</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eventing/">eventing</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/http/">http</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/microservices/">microservices</a></li></ul>

        </div>
        <div class="article-entry" itemprop="articleBody">
            <p>To support the use of Event Grid in our application architecture we decided to build a generic Event Grid client to send our events. This client enforces some practices like the use of base events and error logging.</p>
<h3 id="Event-Grid-event-schema"><a href="#Event-Grid-event-schema" class="headerlink" title="Event Grid event schema"></a>Event Grid event schema</h3><p>Event Grid events have a set schema which needs to be send and which Event Grid will again route to subscribers. The json looks like this (this is an event defined by Azure Storage):</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"topic"</span>: <span class="string">"/subscriptions/&#123;subscription-id&#125;/resourceGroups/Storage/providers/Microsoft.Storage/storageAccounts/xstoretestaccount"</span>,</span><br><span class="line">    <span class="attr">"subject"</span>: <span class="string">"/blobServices/default/containers/oc2d2817345i200097container/blobs/oc2d2817345i20002296blob"</span>,</span><br><span class="line">    <span class="attr">"eventType"</span>: <span class="string">"Microsoft.Storage.BlobCreated"</span>,</span><br><span class="line">    <span class="attr">"eventTime"</span>: <span class="string">"2017-06-26T18:41:00.9584103Z"</span>,</span><br><span class="line">    <span class="attr">"id"</span>: <span class="string">"831e1650-001e-001b-66ab-eeb76e069631"</span>,</span><br><span class="line">    <span class="attr">"data"</span>: &#123;</span><br><span class="line">      <span class="attr">"api"</span>: <span class="string">"PutBlockList"</span>,</span><br><span class="line">      <span class="attr">"clientRequestId"</span>: <span class="string">"6d79dbfb-0e37-4fc4-981f-442c9ca65760"</span>,</span><br><span class="line">      <span class="attr">"requestId"</span>: <span class="string">"831e1650-001e-001b-66ab-eeb76e000000"</span>,</span><br><span class="line">      <span class="attr">"eTag"</span>: <span class="string">"0x8D4BCC2E4835CD0"</span>,</span><br><span class="line">      <span class="attr">"contentType"</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">      <span class="attr">"contentLength"</span>: <span class="number">524288</span>,</span><br><span class="line">      <span class="attr">"blobType"</span>: <span class="string">"BlockBlob"</span>,</span><br><span class="line">      <span class="attr">"url"</span>: <span class="string">"https://oc2d2817345i60006.blob.core.windows.net/oc2d2817345i200097container/oc2d2817345i20002296blob"</span>,</span><br><span class="line">      <span class="attr">"sequencer"</span>: <span class="string">"00000000000004420000000000028963"</span>,</span><br><span class="line">      <span class="attr">"storageDiagnostics"</span>: &#123;</span><br><span class="line">        <span class="attr">"batchId"</span>: <span class="string">"b68529f3-68cd-4744-baa4-3c0498ec19f0"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"dataVersion"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"metadataVersion"</span>: <span class="string">"1"</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Most fields are probably pretty logical, but I want to call out the data field, because this is where you can put your own “Event” data. To make it easy to work with I made a POCO class to represent the event schema. This way you can serialize back and forth easily between json and a class. The Data field is represented as a generic T, because this could be of any type. You could add a generic class or a JObject if you need a generic representation of the event (if you want to receive multiple different event types for example.<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class GridEvent&lt;T&gt; where T : class</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Subject &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> EventType &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> T Data &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DateTime EventTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Topic &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> DataVersion &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> MetadataVersion &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>I made some base classes for specific events which would be in the Data block. For example every event in our organization contains a SourceApplicationName and we have the validationcode added in this event to support easier handling of returning the validationcode when a Event Grid event subscription is added. We have another base event that inherits from that one for user specific events with a UserId. All events need to inherit from these base events, something the generic client enforces.<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AppGridEvent</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> SourceApplicationName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> ValidationCode &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AppGridUserEvent</span> : <span class="title">AppGridEvent</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Guid UserId &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Generic-client"><a href="#Generic-client" class="headerlink" title="Generic client"></a>Generic client</h3><p>Sending events is easy. It is just a HTTP Post, but still there is value in having a generic client to do this. It can handle a couple of things for you that make life easier. </p>
<p><strong>Configuration</strong><br>Our clients constructor takes a couple of configuration values:<br><strong>TopicEndpointUrl</strong>: The url where events will be send<br><strong>SasToken</strong>: The token used to authenticate with EventGrid (so you are allowed to send the event)<br><strong>ApplicationName</strong>: Name of the calling application so we always know the source (this is automatically set by the client)<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EventClient</span> : <span class="title">IEventClient</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> EventClientConfig _config;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> TelemetryClient _telemetryClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> HttpClient _client;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EventClient</span>(<span class="params">EventClientConfig config, TelemetryClient telemetryClient</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (config == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">"config"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (config.TopicEndpointUrl == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">"TopicEndpointUrl cannot be null"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (config.SasToken == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">"SasToken cannot be null"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (config.ApplicationName == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">"ApplicationName cannot be null"</span>);</span><br><span class="line">    </span><br><span class="line">        _config = config;</span><br><span class="line">        _telemetryClient = telemetryClient;</span><br><span class="line">        </span><br><span class="line">        _client = <span class="keyword">new</span> HttpClient();</span><br><span class="line">        client.DefaultRequestHeaders.Add(<span class="string">"aeg-sas-key"</span>, _config.SasToken);</span><br><span class="line">        client.DefaultRequestHeaders.UserAgent.ParseAdd(_config.ApplicationName);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="keyword">bool</span>&gt; SendEventAsync&lt;T&gt;(T eventData) <span class="keyword">where</span> T : AppGridEvent</span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>These settings come from an object out of our appsettings.json, but obviously could come from where ever you like. </p>
<p>In the constructor we also initialize the HttpClient. Note that every HttpClient constructor call registers a new port on your machine, so our EventClient needs to be used as a singleton or static in your application.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (eventData == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">"eventData"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gridEvent = <span class="keyword">new</span> GridEvent&lt;T&gt;()</span><br><span class="line">&#123;</span><br><span class="line">    Id = Guid.NewGuid().ToString(),</span><br><span class="line">    EventType = <span class="keyword">typeof</span>(T).Name,</span><br><span class="line">    EventTime = DateTime.UtcNow,</span><br><span class="line">    Subject = eventData.Subject,</span><br><span class="line">    Data = eventData,</span><br><span class="line">    DataVersion = <span class="string">""</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">gridEvent.Data.SourceApplicationName = _config.ApplicationName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">string</span> json = JsonConvert.SerializeObject(<span class="keyword">new</span> List&lt;GridEvent&lt;T&gt;&gt;() &#123; gridEvent &#125;);</span><br><span class="line">HttpRequestMessage request = <span class="keyword">new</span> HttpRequestMessage(HttpMethod.Post, _config.TopicEndpointUrl)</span><br><span class="line">&#123;</span><br><span class="line">    Content = <span class="keyword">new</span> StringContent(json, Encoding.UTF8, <span class="string">"application/json"</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = <span class="keyword">await</span> _client.SendAsync(request);</span><br></pre></td></tr></table></figure>
<p>The client receives a generic object of base type AppGridEvent which contains the base fields like ApplicationName. This base type is serialized in json and a HttpRequestMessage is created. This message is send to EventGrid and we record if a successful message is return. </p>
<p>One open point right now is versioning. When the time comes when we need it, I plan to get the version from an attribute on the POCO class.</p>
<h3 id="Catching-exceptions"><a href="#Catching-exceptions" class="headerlink" title="Catching exceptions"></a>Catching exceptions</h3><p>In our application events that we throw don’t need to be transaction. We want as many as possible, but if we sometimes miss some, that is fine. So we catch any errors that occur on sending of the event, because we don’t want this to bubble up to the user. This works very well for us, because we rather miss an event than the user being impacted by one of these errors. But keep in mind, this might not work for everyone/all type of events.<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    ...    </span><br><span class="line">    <span class="keyword">if</span> (!result.IsSuccessStatusCode)</span><br><span class="line">    &#123;</span><br><span class="line">        _telemetryClient.TrackException(<span class="keyword">new</span> Exception(<span class="string">$"SendEventAsync resulted in invalid statuscode <span class="subst">&#123;result.StatusCode.ToString()&#125;</span>"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result.IsSuccessStatusCode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Exception exc)</span><br><span class="line">&#123;</span><br><span class="line">    _telemetryClient.TrackException(exc);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>In case of an incorrect result status code we log this code, but you could also throw an exception here. Keep in mind that you will need to check this, just catching exceptions is not enough to see all failed requests.</p>
<h3 id="Sharing-of-events-event-types"><a href="#Sharing-of-events-event-types" class="headerlink" title="Sharing of events (event types)"></a>Sharing of events (event types)</h3><p>At the moment we use a nuget package to share events definitions (in the form of the POCO classes) between the different applications that use this event. This package is stored in a private Visual Studio online package repositry. This works very well and enforces that when the event is changed (and the nuget package is updated) the applications break. But it does somewhat break the principle that the source application is the owner of the schema.</p>
<p>Until now this approach has been working well for us. But I am always open for suggestions, so if you see possible improvements, please let me know!</p>

        </div>
        <footer class="article-footer">
            



    <a data-url="http://eriksteinebach.com/2018/05/14/generic-client-for-sending-events-to-eventgrid/" data-id="cji9lqety00076w9hgc2d0d89" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>

                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="http://www.twitter.com/eriksteinebach" target="_blank">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="linkedin" href="https://www.linkedin.com/in/eriksteinebach" target="_blank">
                        <i class="icon fa fa-linkedin"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="facebook" href="http://www.facebook.com/eriksteinebach" target="_blank">
                        <i class="icon fa fa-facebook"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="instagram" href="https://instagram.com/eriksteinebach" target="_blank">
                        <i class="icon fa fa-instagram"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/eriksteinebach" target="_blank">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/rss2.xml" target="_blank">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2018/06/10/application-insights-for-javascript-script/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">newer</strong>
        <p class="article-nav-title">
        
            Javascript script for Application Insights
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2018/05/10/azure-eventgrid-vs-azure-servicebus/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">older</strong>
        <p class="article-nav-title">Azure Event Grid vs Azure Service Bus</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                <div class="widget-wrap widget-float">
	<div class="widget about">
		<h3 class="widget-title">About Erik Steinebach</h3>
		
			<img src="/images/about.jpg" style="float: left; padding-right: 10px;" />
		
		I am a digital nomad, a .NET developer, a software architect, a development process consultant and a new technology enthusiast. Originally from The Netherlands, but currently living in Lima, Peru.
	</div>
</div>


            
                
    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/06/10/application-insights-for-javascript-script/" class="thumbnail">
    
    
        <span style="background-image:url(/2018/06/10/application-insights-for-javascript-script/intro.png)" alt="Javascript script for Application Insights" class="thumbnail-image"></span>
    
    
</a>
                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Coding/">Coding</a></p>
                            <p class="item-title"><a href="/2018/06/10/application-insights-for-javascript-script/" class="title">Javascript script for Application Insights</a></p>
                            <p class="item-date"><time datetime="2018-06-11T01:33:40.000Z" itemprop="datePublished">2018-06-10</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/05/14/generic-client-for-sending-events-to-eventgrid/" class="thumbnail">
    
    
        <span style="background-image:url(/2018/05/14/generic-client-for-sending-events-to-eventgrid/serverless-web-app.png)" alt="Generic client for sending events to Event Grid" class="thumbnail-image"></span>
    
    
</a>
                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Coding/">Coding</a></p>
                            <p class="item-title"><a href="/2018/05/14/generic-client-for-sending-events-to-eventgrid/" class="title">Generic client for sending events to Event Grid</a></p>
                            <p class="item-date"><time datetime="2018-05-14T13:05:45.000Z" itemprop="datePublished">2018-05-14</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/05/10/azure-eventgrid-vs-azure-servicebus/" class="thumbnail">
    
    
        <span style="background-image:url(/2018/05/10/azure-eventgrid-vs-azure-servicebus/azure-service-bus-event-grid.jpg)" alt="Azure Event Grid vs Azure Service Bus" class="thumbnail-image"></span>
    
    
</a>
                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Architecture/">Architecture</a></p>
                            <p class="item-title"><a href="/2018/05/10/azure-eventgrid-vs-azure-servicebus/" class="title">Azure Event Grid vs Azure Service Bus</a></p>
                            <p class="item-date"><time datetime="2018-05-10T22:56:16.000Z" itemprop="datePublished">2018-05-10</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/05/06/specific-user-application-insights-netcore/" class="thumbnail">
    
    
        <span style="background-image:url(/2018/05/06/specific-user-application-insights-netcore/thumbnail.png)" alt="Follow a specific user in Application Insights .NET Core edition" class="thumbnail-image"></span>
    
    
</a>
                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Coding/">Coding</a></p>
                            <p class="item-title"><a href="/2018/05/06/specific-user-application-insights-netcore/" class="title">Follow a specific user in Application Insights .NET Core edition</a></p>
                            <p class="item-date"><time datetime="2018-05-06T17:20:03.000Z" itemprop="datePublished">2018-05-06</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/12/26/Follow-a-specific-user-with-Application-Insights-by-setting-AuthenticatedUserId/" class="thumbnail">
    
    
        <span style="background-image:url(/2016/12/26/Follow-a-specific-user-with-Application-Insights-by-setting-AuthenticatedUserId/thumbnail.jpg)" alt="Follow a specific user with Application Insights by setting AuthenticatedUserId" class="thumbnail-image"></span>
    
    
</a>
                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Coding/">Coding</a></p>
                            <p class="item-title"><a href="/2016/12/26/Follow-a-specific-user-with-Application-Insights-by-setting-AuthenticatedUserId/" class="title">Follow a specific user with Application Insights by setting AuthenticatedUserId</a></p>
                            <p class="item-date"><time datetime="2016-12-26T14:32:08.000Z" itemprop="datePublished">2016-12-26</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/net/" style="font-size: 18px;">.net</a> <a href="/tags/net-core/" style="font-size: 10px;">.net core</a> <a href="/tags/Housekeeping/" style="font-size: 10px;">Housekeeping</a> <a href="/tags/angularjS/" style="font-size: 10px;">angularjS</a> <a href="/tags/application-insights/" style="font-size: 14px;">application insights</a> <a href="/tags/architecture/" style="font-size: 10px;">architecture</a> <a href="/tags/asp-net/" style="font-size: 16px;">asp.net</a> <a href="/tags/azure/" style="font-size: 20px;">azure</a> <a href="/tags/backpacking/" style="font-size: 10px;">backpacking</a> <a href="/tags/barchart/" style="font-size: 10px;">barchart</a> <a href="/tags/charts/" style="font-size: 10px;">charts</a> <a href="/tags/client/" style="font-size: 10px;">client</a> <a href="/tags/continuous-delivery/" style="font-size: 14px;">continuous delivery</a> <a href="/tags/d3-js/" style="font-size: 10px;">d3.js</a> <a href="/tags/dateTime/" style="font-size: 10px;">dateTime</a> <a href="/tags/devops/" style="font-size: 16px;">devops</a> <a href="/tags/dotnetcore/" style="font-size: 10px;">dotnetcore</a> <a href="/tags/event-grid/" style="font-size: 12px;">event grid</a> <a href="/tags/eventing/" style="font-size: 12px;">eventing</a> <a href="/tags/graphs/" style="font-size: 10px;">graphs</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/javascript/" style="font-size: 14px;">javascript</a> <a href="/tags/kudu/" style="font-size: 10px;">kudu</a> <a href="/tags/linechart/" style="font-size: 10px;">linechart</a> <a href="/tags/microservices/" style="font-size: 12px;">microservices</a> <a href="/tags/netcore/" style="font-size: 10px;">netcore</a> <a href="/tags/response/" style="font-size: 10px;">response</a> <a href="/tags/service-bus/" style="font-size: 10px;">service bus</a> <a href="/tags/time/" style="font-size: 10px;">time</a> <a href="/tags/tracking-and-tracing/" style="font-size: 14px;">tracking and tracing</a> <a href="/tags/user-tracking/" style="font-size: 14px;">user tracking</a> <a href="/tags/vsts/" style="font-size: 10px;">vsts</a> <a href="/tags/yeoman/" style="font-size: 10px;">yeoman</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/">Architecture</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Coding/">Coding</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/">DevOps</a><span class="category-list-count">4</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">2</span></li></ul>
        </div>
    </div>


            
        
    </div>
</aside>
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2018 Erik Steinebach</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_shortname = 'eriksteinebachcom';
    
    
    var disqus_url = 'http://eriksteinebach.com/2018/05/14/generic-client-for-sending-events-to-eventgrid/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>



    
        <script src="/vendor/fancybox/jquery.fancybox.pack.js"></script>
    

    
        <script src="/vendor/scrollLoading/jquery.scrollLoading.js"></script>
        <script src="/vendor/scrollLoading/main.js"></script>
    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
